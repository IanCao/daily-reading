# All things caching- use cases, benefits, strategies, choosing a caching technology, exploring some popular products

## 缓存先决条件

- 业务用例中哪些需要用到缓存？是否需要高吞吐量、快速响应或低延迟？
- 如何处理缓存不一致的情况？
- 需要缓存哪些数据结构？
- 需要进程内缓存还是分布式缓存？
- 如果使用分布式缓存，那么性能、可靠性、可伸缩性和可用性如何考虑？

## 缓存的好处

有效的缓存有助于内容使用者和内容提供者，缓存为内容交付提供以下好处：

- 降低网络成本：当缓存到离使用者比较近的位置时，请求将不会产生缓存之外的其他网络活动
- 改进网络成本：缓存使得内容检索更快，因为不需要经过整个网络链路
- 网络中断期间提供内容的可用性

## 常规缓存用例

- 缓解 RDBMS 的压力，加速访问
- 缓存热点数据、统计数据，处理网络、移动应用程序中的峰值
- 会话存储
- 全局 ID 生成器或计数器
- 缓存任何需要快速访问的数据

## 缓存访问策略

### 读取策略

1. 读取/延迟加载：获取数据时首先从缓存中获取，若缓存缺失，才从数据源检索数据，并将其放入缓存中，然后返回
   - 优点
     - 按需加载数据
     - 可扩展性好：缓存节点可自由加减，不损害应用
   - 缺点
     - 对于缓存缺失的情况，会有三次网络往返（检入缓存、从数据库检索、更新缓存）。因此，缓存可能会导致响应延迟

### 更新策略

1. 直写：在数据库插入或更新数据时，也要追加或更新缓存中的数据。因此两个操作都应在单个事务中进行，否则数据将陈旧。
   - 缺点
     - 每个写入操作都会执行两个网络操作，有些数据写入后可能暂时不需要被使用
     - 为了保持数据的一致性，在数据写入时，如果缺少任何缓存节点数据写入失败，则写入操作完全失败
2. 在缓存后写入：数据直接写入缓存，然后再特定的配置时间间隔后，写入的数据异步写入到基础数据源。
   - 优点
     - 应用程序无需等待数据写入基础数据源，读取和写入都在缓存端，提高了性能
     - 应用程序与数据库故障隔离，如果数据库失败，可以重试写入
     - 适用于高读写吞吐量的系统
   - 缺点
     - 对数据库的直接操作可能会产生数据的不一致
   - 设计约束
     - 由于先写入缓存再写入数据库，因此，如果无法将缓存的项目写入数据库，则必须进行一些回滚操作以保持一定时间范围内的一致性
3. 缓存淘汰策略
   - 最近最少使用（LRU）
   - 最少使用（LFU）
   - 最近使用（LMU）
   - 先进先出（FIFO）

...