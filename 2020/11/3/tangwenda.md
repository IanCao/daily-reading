##Cache is the Root of All Evil
[原文链接](https://medium.com/box-tech-blog/cache-is-the-root-of-all-evil-e64ebd7cbd3b)

### Why Cache
存储的收纳空间和响应速度难以兼得。引入空间上限更小但是速度更快的缓存，
在存在热点数据时引入缓存，可以减少响应时延并降低数据库的压力。
>在引入缓存前，问自己数据库中的数据访问热度差异有多大？
>数据库流量/性能接近瓶颈了吗？
>缓存中间层带来的额外复杂度值得吗？

### How to Cache
本文主要讨论针对读流量来优化的缓存。

- 数据变更时需要将受影响的缓存全部无效化
- 采用租约，一方面保证读写操作并发后缓存与数据库的数据一致性，
另一方面在对于同一 key 大量并发读写操作时保护数据库。

租约虽好，不过还有个遗留问题：当对于同一个 key 的大量读操作和写操作并发时，
为了保证数据一致性牺牲了请求的响应时间。而事实上，此时多个竞争同一个租约的读请求，
其访问结果是可以共用的，不需要重新去取缓存。递归操作并不复杂不再赘述。
>有点引入一层额外中间层的味道？缓存中存在竞争，结果可以复用，
>所以引入一个存储 lease -> value 的中间层。中间层在本地内存中，
>读写代价和操作失败可能性可以忽略不计。中间层的数据对于租约本身而言，
>是强一致性的；对于读请求而言，租约过期后也无需再维护租约对应的数据的
>正确性了。

